
<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SIROCCO Tournament – Mobil v2</title>
<style>
  :root{--bg:#fff;--ink:#222;--accent:#c0392b;--muted:#eaeaea}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
  header{padding:12px 16px;border-bottom:1px solid var(--muted);background:#fff;position:sticky;top:0;z-index:1}
  h1{font-size:18px;margin:0;color:var(--accent)}
  .wrap{max-width:720px;margin:0 auto;padding:12px 16px}
  .card{background:#fff;border:1px solid var(--muted);border-radius:10px;padding:12px;margin:12px 0;box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .row>div{flex:1 1 100%}
  label{display:block;font-size:12px;color:#555;margin:8px 0 4px}
  input[type=text]{width:100%;padding:10px 12px;border:1px solid #d0d0d0;border-radius:8px;font-size:16px}
  .match{padding:8px 0;border-top:1px dashed #ddd}
  .match:first-child{border-top:none}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  th{font-weight:600}
  .note{font-size:12px;color:#666}
  .rank{font-variant-numeric:tabular-nums}
  .footer{font-size:12px;color:#666;margin:12px 0}
  .btn{appearance:none;border:1px solid var(--accent);background:var(--accent);color:#fff;border-radius:8px;padding:10px 12px;font-weight:600}
  .btn.secondary{background:#fff;color:var(--accent)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #ddd;background:#fafafa;font-size:12px}
</style>
</head>
<body>
<header>
  <h1>SIROCCO Tournament – Mobil</h1>
  <div class="note">Fyll i <strong>gem</strong> (t.ex. 21-18). 2p för flest gem, 1p vid lika. Gem +/- fungerar som målskillnad. Slutspelsmatcherna i omgång 4 fylls i automatiskt när grundserien (omgång 1–4) är ifylld.</div>
</header>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div>
        <label for="round">Omgång</label>
        <select id="round"></select>
      </div>
      <div>
        <span class="pill" id="status">Grundserie pågår</span>
      </div>
    </div>
    <div id="matches"></div>
    <div class="row" style="gap:8px;margin-top:12px">
      <button class="btn" id="clearRound">Rensa omgång</button>
      <button class="btn secondary" id="clearAll">Nollställ allt</button>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 8px">Tabell</h2>
    <div class="note">Sorterar på poäng → gem +/-</div>
    <table id="table">
      <thead><tr><th>Spelare</th><th class="rank">Poäng</th><th class="rank">Gem +/-</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer">v2 – Omgång 4 innehåller automatiska slutspelsmatcher. Omgång 6–8 borttagna.</div>
</div>
<script>
const players = [
  'Kristofer Winge','Henrik Nyiri','Emil Svensson','Henrik Winskogh',
  'Robert Norberg','Sasha Koterac','Håkan Norberg','Magnus Bengtsson'
];
const pid = {
  'Kristofer Winge':'KWinge','Henrik Nyiri':'HNyiri','Emil Svensson':'ESvensson','Henrik Winskogh':'HWinskogh',
  'Robert Norberg':'RNorberg','Sasha Koterac':'SKoterac','Håkan Norberg':'HNorberg','Magnus Bengtsson':'MBengtsson'
};
const nameById = Object.fromEntries(Object.entries(pid).map(([name,id])=>[id,name]));

// Schema (omgång 1–4 = grundserie), omgång 4 innehåller även 2 slutspelsmatcher
const schedule = {
  1: [
    {name:'Match 1A', f:'r1_m1a', t1:['KWinge','HNyiri'], t2:['ESvensson','HWinskogh'], label:'Kristofer Winge + Henrik Nyiri vs Emil Svensson + Henrik Winskogh', counted:true},
    {name:'Match 1B', f:'r1_m1b', t1:['RNorberg','SKoterac'], t2:['HNorberg','MBengtsson'], label:'Robert Norberg + Sasha Koterac vs Håkan Norberg + Magnus Bengtsson', counted:true},
    {name:'Match 2A', f:'r1_m2a', t1:['KWinge','ESvensson'], t2:['HNyiri','RNorberg'], label:'Kristofer Winge + Emil Svensson vs Henrik Nyiri + Robert Norberg', counted:true},
    {name:'Match 2B', f:'r1_m2b', t1:['HWinskogh','HNorberg'], t2:['SKoterac','MBengtsson'], label:'Henrik Winskogh + Håkan Norberg vs Sasha Koterac + Magnus Bengtsson', counted:true},
  ],
  2: [
    {name:'Match 3A', f:'r2_m3a', t1:['KWinge','HWinskogh'], t2:['ESvensson','RNorberg'], label:'Kristofer Winge + Henrik Winskogh vs Emil Svensson + Robert Norberg', counted:true},
    {name:'Match 3B', f:'r2_m3b', t1:['HNyiri','HNorberg'], t2:['SKoterac','MBengtsson'], label:'Henrik Nyiri + Håkan Norberg vs Sasha Koterac + Magnus Bengtsson', counted:true},
    {name:'Match 4A', f:'r2_m4a', t1:['KWinge','RNorberg'], t2:['HWinskogh','SKoterac'], label:'Kristofer Winge + Robert Norberg vs Henrik Winskogh + Sasha Koterac', counted:true},
    {name:'Match 4B', f:'r2_m4b', t1:['ESvensson','HNorberg'], t2:['HNyiri','MBengtsson'], label:'Emil Svensson + Håkan Norberg vs Henrik Nyiri + Magnus Bengtsson', counted:true},
  ],
  3: [
    {name:'Match 5A', f:'r3_m5a', t1:['KWinge','HNorberg'], t2:['RNorberg','MBengtsson'], label:'Kristofer Winge + Håkan Norberg vs Robert Norberg + Magnus Bengtsson', counted:true},
    {name:'Match 5B', f:'r3_m5b', t1:['HWinskogh','ESvensson'], t2:['SKoterac','HNyiri'], label:'Henrik Winskogh + Emil Svensson vs Sasha Koterac + Henrik Nyiri', counted:true},
    {name:'Match 6A', f:'r3_m6a', t1:['KWinge','SKoterac'], t2:['HNorberg','MBengtsson'], label:'Kristofer Winge + Sasha Koterac vs Håkan Norberg + Magnus Bengtsson', counted:true},
    {name:'Match 6B', f:'r3_m6b', t1:['RNorberg','HWinskogh'], t2:['ESvensson','HNyiri'], label:'Robert Norberg + Henrik Winskogh vs Emil Svensson + Henrik Nyiri', counted:true},
  ],
  4: [
    {name:'Match 7A', f:'r4_m7a', t1:['KWinge','MBengtsson'], t2:['SKoterac','HNorberg'], label:'Kristofer Winge + Magnus Bengtsson vs Sasha Koterac + Håkan Norberg', counted:true},
    {name:'Match 7B', f:'r4_m7b', t1:['HNyiri','HWinskogh'], t2:['ESvensson','RNorberg'], label:'Henrik Nyiri + Henrik Winskogh vs Emil Svensson + Robert Norberg', counted:true},
    // Slutspelsmatcher (ej räknas i tabellen)
    {name:'Slutspel A (1:a & 2:a vs 3:a & 4:a)', f:'r4_sfA', t1:[], t2:[], label:'Fylls i automatiskt när grundserien (1–4) är klar', counted:false, dynamic:true},
    {name:'Slutspel B (5:a & 6:a vs 7:a & 8:a)', f:'r4_sfB', t1:[], t2:[], label:'Fylls i automatiskt när grundserien (1–4) är klar', counted:false, dynamic:true},
  ],
  5: [ ]
};

const state = { results: {} };

function parseScore(s){
  if(!s) return null; const p = s.replace(/\s+/g,'').split('-');
  if(p.length!==2) return null; const a = parseInt(p[0],10), b = parseInt(p[1],10);
  if(Number.isNaN(a) || Number.isNaN(b)) return null; return [a,b];
}

function ensureFields(){
  for(const r of Object.keys(schedule)){
    for(const m of schedule[r]){ state.results[m.f] = state.results[m.f] || ''; }
  }
}

function computeTable(){
  const pts = {}, gd = {}; Object.values(pid).forEach(id=>{ pts[id]=0; gd[id]=0; });
  function applyVal(field, team1, team2){
    const s = state.results[field]; const sc = parseScore(s); if(!sc) return;
    const [a,b] = sc; const diff = a-b; let p1=0,p2=0; if(a>b){p1=2;} else if(a<b){p2=2;} else {p1=1;p2=1;}
    team1.forEach(id=>{ pts[id]+=p1; gd[id]+=diff; });
    team2.forEach(id=>{ pts[id]+=p2; gd[id]-=diff; });
  }
  for(const round of [1,2,3,4]){
    for(const m of schedule[round]){ if(m.counted){ applyVal(m.f, m.t1, m.t2); } }
  }
  const rows = players.map(name=>({ name, id:pid[name], p:pts[pid[name]], g:gd[pid[name]] }));
  rows.sort((a,b)=> b.p - a.p || b.g - a.g || a.name.localeCompare(b.name));
  return rows;
}

function groupComplete(){
  for(const round of [1,2,3,4]){
    for(const m of schedule[round]){
      if(m.counted){ if(!parseScore(state.results[m.f])) return false; }
    }
  }
  return true;
}

function playoffPairsFromTable(rows){
  const ids = rows.map(r=>r.id);
  return {
    A: { t1:[ids[0], ids[1]], t2:[ids[2], ids[3]] },
    B: { t1:[ids[4], ids[5]], t2:[ids[6], ids[7]] }
  };
}

function teamLabel(ids){ return ids.map(id=>nameById[id]).join(' + '); }

function renderRound(n){
  const box = document.getElementById('matches'); box.innerHTML='';
  const rows = computeTable();
  const ready = groupComplete();
  document.getElementById('status').textContent = ready? 'Grundserie klar – slutspel klart' : 'Grundserie pågår';

  let playoff = null; if(ready){ playoff = playoffPairsFromTable(rows); }

  (schedule[n]||[]).forEach((m)=>{
    const wrap = document.createElement('div'); wrap.className='match';
    let subLabel = m.label;
    if(m.dynamic){
      if(ready){
        const pair = m.f==='r4_sfA' ? playoff.A : playoff.B;
        subLabel = teamLabel(pair.t1) + ' vs ' + teamLabel(pair.t2);
      }
    }
    wrap.innerHTML = `<div class="row"><div><label>${m.name}</label><div class="note" id="lbl_${m.f}">${subLabel}</div></div></div>
      <div class="row"><div><input inputmode="numeric" pattern="[0-9\- ]+" type="text" placeholder="ex. 21-18" value="${state.results[m.f]||''}" data-field="${m.f}"></div></div>`;
    box.appendChild(wrap);
  });
}

function renderTable(){
  const rows = computeTable();
  const tb = document.querySelector('#table tbody');
  tb.innerHTML = rows.map(r=>`<tr><td>${r.name}</td><td class="rank">${r.p}</td><td class="rank">${r.g>0?'+':''}${r.g}</td></tr>`).join('');
}

function attach(){
  document.getElementById('matches').addEventListener('input', e=>{
    if(e.target && e.target.dataset.field){ state.results[e.target.dataset.field]=e.target.value; renderTable(); if(parseInt(document.getElementById('round').value,10)===4) renderRound(4); else {
      document.getElementById('status').textContent = groupComplete()? 'Grundserie klar – slutspel klart' : 'Grundserie pågår';
    } }
  });
  document.getElementById('clearRound').addEventListener('click',()=>{
    const r = parseInt(document.getElementById('round').value,10); (schedule[r]||[]).forEach(m=>state.results[m.f]=''); renderRound(r); renderTable();
  });
  document.getElementById('clearAll').addEventListener('click',()=>{ for(const k of Object.keys(state.results)) state.results[k]=''; renderRound(parseInt(document.getElementById('round').value,10)); renderTable(); });
}

function init(){
  ensureFields(); attach();
  const sel = document.getElementById('round');
  for(const n of [1,2,3,4,5]){ const opt=document.createElement('option'); opt.value=n; opt.textContent = `Omgång ${n}`; sel.appendChild(opt); }
  sel.value=1; sel.addEventListener('change',()=>renderRound(parseInt(sel.value,10)));
  renderRound(1); renderTable();
}
init();
</script>
</body>
</html>
