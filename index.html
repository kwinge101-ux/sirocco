
<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SIROCCO Tournament – Mobil v3</title>
<style>
  :root{--bg:#fff;--ink:#222;--accent:#c0392b;--muted:#eaeaea;--ok:#27ae60;--warn:#e67e22}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--muted);padding:14px 16px;z-index:5}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .wrap{max-width:860px;margin:0 auto;padding:12px 16px}
  .grid{display:grid;gap:12px}
  .card{background:#fff;border:1px solid var(--muted);border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--muted);font-size:16px}
  .card .body{padding:12px 14px}
  .match{padding:10px 0;border-top:1px dashed #eee}
  .match:first-child{border-top:none}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .teams{font-weight:600}
  input[type=text]{flex:0 0 120px;padding:10px;border:1px solid #d0d0d0;border-radius:8px;font-size:16px}
  .hint{font-size:12px;color:#666}
  .btn{appearance:none;border:1px solid var(--accent);background:var(--accent);color:#fff;border-radius:10px;padding:10px 12px;font-weight:600;cursor:pointer}
  .btn.secondary{background:#fff;color:var(--accent)}
  .btn.small{padding:6px 10px;font-size:12px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  th{font-weight:700}
  .rank{font-variant-numeric:tabular-nums;text-align:right}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid #ddd;background:#fafafa;font-size:12px}
  .ok{color:var(--ok)}
  .warn{color:var(--warn)}
  .muted{color:#777}
  .section-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  footer{text-align:center;color:#888;font-size:12px;padding:16px}
</style>
</head>
<body>
  <header>
    <h1>SIROCCO v3 – Mobil</h1>
    <div class="hint">Fyll i <b>gem</b> (t.ex. <code>21-18</code>). 2p för flest gem, 1p vid lika. Gem +/- avgör vid lika poäng.</div>
  </header>
  <main class="wrap grid">
    <!-- Sektion 1: Schema -->
    <section class="card" id="sec-schema">
      <h2>Schema (14 matcher)</h2>
      <div class="body" id="schema"></div>
      <div class="body section-actions">
        <button class="btn" id="btn-save">Spara lokalt</button>
        <button class="btn secondary" id="btn-load">Ladda sparat</button>
        <button class="btn secondary" id="btn-clear">Nollställ allt</button>
      </div>
    </section>

    <!-- Sektion 2: Tabell -->
    <section class="card" id="sec-table">
      <h2>Tabell</h2>
      <div class="body">
        <div class="hint" id="status">Grundserie pågår…</div>
        <table>
          <thead>
            <tr><th>Spelare</th><th class="rank">Spelade</th><th class="rank">Poäng</th><th class="rank">Gem +/-</th></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <!-- Sektion 3: Slutspel -->
    <section class="card" id="sec-playoff">
      <h2>Slutspel</h2>
      <div class="body" id="playoff">
        <div class="hint">Slutspel skapas automatiskt när alla 14 matcher har giltiga resultat.</div>
      </div>
    </section>
  </main>
  <footer>SIROCCO – byggd för mobil. Spara på hemskärmen för app‑känsla.</footer>

<script>
const players = {"0": "Kristofer Winge", "1": "Henrik Nyiri", "2": "Emil Svensson", "3": "Henrik Winskogh", "4": "Robert Norberg", "5": "Sasha Koterac", "6": "Håkan Norberg", "7": "Magnus Bengtsson"};
const schedule = [[[0, 1], [2, 3]], [[0, 2], [1, 3]], [[0, 3], [1, 2]], [[0, 4], [1, 5]], [[0, 5], [1, 4]], [[0, 6], [1, 7]], [[0, 7], [1, 6]], [[2, 4], [3, 5]], [[2, 5], [3, 4]], [[2, 6], [3, 7]], [[2, 7], [3, 6]], [[4, 5], [6, 7]], [[4, 6], [5, 7]], [[4, 7], [5, 6]]]; // [[t1a,t1b],[t2a,t2b]]

const results = JSON.parse(localStorage.getItem('sirocco_v3_results')||'{}');

function teamLabel(team){ return team.map(id=>players[id]).join(' + '); }
function matchKey(i){ return 'm'+(i+1); }
function parseScore(s){ if(!s) return null; const p=s.toString().replace(/\s+/g,'').split('-'); if(p.length!==2) return null; const a=parseInt(p[0],10), b=parseInt(p[1],10); if(Number.isNaN(a)||Number.isNaN(b)) return null; return [a,b]; }

function renderSchema(){
  const wrap=document.getElementById('schema'); wrap.innerHTML='';
  schedule.forEach((m,idx)=>{
    const [t1,t2]=m; const div=document.createElement('div'); div.className='match';
    const label = `<div class="teams">Match ${idx+1}: ${teamLabel(t1)} <span class="muted">vs</span> ${teamLabel(t2)}</div>`;
    const val = results[matchKey(idx)]||'';
    div.innerHTML = `<div class='row'>${label}<input type='text' placeholder='ex. 21-18' value='${val}' data-m='${idx}'></div>`;
    wrap.appendChild(div);
  });
  wrap.addEventListener('input', (e)=>{ if(e.target && e.target.dataset.m){ results[matchKey(parseInt(e.target.dataset.m))]=e.target.value; computeAndRender(); }});
}

function emptyStats(){ const s={}; Object.keys(players).forEach(id=>s[id]={p:0, gd:0, played:0}); return s; }

function computeTable(){
  const stats=emptyStats();
  schedule.forEach((m,idx)=>{
    const s = parseScore(results[matchKey(idx)]||'');
    if(!s) return; const [a,b]=s; const [t1,t2]=m; const diff=a-b; let p1=0,p2=0; if(a>b){p1=2;} else if(a<b){p2=2;} else {p1=1;p2=1;}
    t1.forEach(id=>{ stats[id].p+=p1; stats[id].gd+=diff; stats[id].played++; });
    t2.forEach(id=>{ stats[id].p+=p2; stats[id].gd-=diff; stats[id].played++; });
  });
  const rows = Object.keys(players).map(id=>({id, name:players[id], ...stats[id]}));
  rows.sort((a,b)=> b.p - a.p || b.gd - a.gd || a.name.localeCompare(b.name));
  const allValid = schedule.every((_,i)=> parseScore(results[matchKey(i)]||'') );
  return {rows, allValid};
}

function renderTable(){
  const {rows, allValid} = computeTable();
  const tb=document.getElementById('tbody'); tb.innerHTML='';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r.name}</td><td class='rank'>${r.played}</td><td class='rank'>${r.p}</td><td class='rank'>${r.gd>0?'+':''}${r.gd}</td>`;
    tb.appendChild(tr);
  });
  document.getElementById('status').innerHTML = allValid ? `<span class='pill ok'>Grundserie klar</span>` : `<span class='pill'>Grundserie pågår…</span>`;
  return allValid ? rows : null;
}

function renderPlayoff(){
  const box = document.getElementById('playoff');
  const rowsFull = renderTable();
  if(!rowsFull){ box.innerHTML = `<div class='hint'>Slutspel skapas automatiskt när alla 14 matcher har giltiga resultat.</div>`; return; }
  const ids = rowsFull.map(r=>r.id);
  const A = { t1:[ids[0],ids[1]], t2:[ids[2],ids[3]] };
  const B = { t1:[ids[4],ids[5]], t2:[ids[6],ids[7]] };
  localStorage.setItem('sirocco_v3_playoff', JSON.stringify({A,B}));
  const rA = results['sfA']||''; const rB = results['sfB']||'';

  box.innerHTML = `
    <div class='match'>
      <div class='teams'>Slutspel A: ${A.t1.map(id=>players[id]).join(' + ')} <span class='muted'>vs</span> ${A.t2.map(id=>players[id]).join(' + ')}</div>
      <div class='row'><input type='text' placeholder='ex. 21-18' value='${rA}' data-sf='A'></div>
    </div>
    <div class='match'>
      <div class='teams'>Slutspel B: ${B.t1.map(id=>players[id]).join(' + ')} <span class='muted'>vs</span> ${B.t2.map(id=>players[id]).join(' + ')}</div>
      <div class='row'><input type='text' placeholder='ex. 21-18' value='${rB}' data-sf='B'></div>
    </div>
    <div class='hint muted'>Slutspel påverkar inte grundseriens tabell.</div>
  `;
  box.addEventListener('input', (e)=>{ if(e.target && e.target.dataset.sf){ results['sf'+e.target.dataset.sf]=e.target.value; localStorage.setItem('sirocco_v3_results', JSON.stringify(results)); }});
}

function computeAndRender(){
  localStorage.setItem('sirocco_v3_results', JSON.stringify(results));
  renderTable();
  renderPlayoff();
}

function boot(){
  renderSchema();
  computeAndRender();
  document.getElementById('btn-save').onclick = ()=>{ localStorage.setItem('sirocco_v3_results', JSON.stringify(results)); alert('Sparat i denna enhet.'); };
  document.getElementById('btn-load').onclick = ()=>{ const saved=JSON.parse(localStorage.getItem('sirocco_v3_results')||'{}'); Object.assign(results, saved); renderSchema(); computeAndRender(); };
  document.getElementById('btn-clear').onclick = ()=>{ if(confirm('Nollställ alla resultat i denna enhet?')){ localStorage.removeItem('sirocco_v3_results'); localStorage.removeItem('sirocco_v3_playoff'); for(let k in results) delete results[k]; renderSchema(); computeAndRender(); } };
}

boot();
</script>
</body>
</html>
